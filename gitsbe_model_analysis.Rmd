---
title: "Gitsbe Model Prediction Performance Analysis"
output:
  html_document:
    df_print: paged
---

## Intro

This notebook includes the ensemble model analysis performed on the models generated by the Gitsbe module when running the DrugLogics computationla pipeline for finding synergistic drug combinations. The analysis will be presented step by step in the text below.

The R version used for this analysis is: **3.4.4 (Someone to Lean On)**.

## Prerequisites

Firstly, we load the required libraries (you need to install them if you don't have them):

```{r message=FALSE}
# require(RColorBrewer)
# require(heatmap.plus)
# require(gplots)
# require(rje)
```

and the relavant helper functions:

```{r}
setwd(".")
source("input_functions.R")
#source("output_functions.R")
#source("plot_functions.R")
#source("analysis_functions.R")
```

## Input

We will now define the name of the cell line which must match the name of the directory that has the input files. There are **3 inputs** used in this analysis:

- The **model_predictions** file which has for each model the prediction for each synergy combination (either *0* = no synergy predicted, *1* = synergy predicted, *NA* = couldn't find stable states in either the drug combination or in any of the single drugs used in the model)
- The **observed_synergies** file which lists the drug combinations that were observed as synergistic.
- THe **models** directory, which is the same as the models directory produced by Gitsbe and has one file per model and includes this info:
    - The *fitness* to the steady state (value between 0 and 1)
    - The *stable state* of the boolean model (can be either 1 stable state or none) and 
    - The *boolean equations* of the model

```{r}
cell.line = "AGS"
data.dir = paste(getwd(), "/", cell.line, "/", sep = "")
model.predictions.file = paste(data.dir, "model_predictions", sep = "")
observed.synergies.file = paste(data.dir, "observed_synergies", sep = "")
models.dir = paste(data.dir, "models", sep = "")
```

Now, we parse the data into proper R objects:
```{r}
model.data = read.model.predictions.file(model.predictions.file)

drug.combinations.tested = colnames(model.data)
models                   = rownames(model.data)

models.number        = dim(model.data)[1]
drug.comb.number     = dim(model.data)[2]
print(paste("Drug Combinations: ", drug.comb.number, ",",
            "Number of Models: ", models.number))

synergy.observations.data = read.observed.synergies.file(
  observed.synergies.file, drug.combinations.tested)

models.stable.state = get.stableState.from.models.dir(models.dir)
models.stable.state = models.stable.state[models,]

models.equations = get.equations.from.models.dir(
  models.dir, removeEquationsHavingLinkOperator = FALSE)
models.equations = models.equations[models,]

models.fitness = get.fitness.from.models.dir(models.dir)
models.fitness = models.fitness[models]
```






